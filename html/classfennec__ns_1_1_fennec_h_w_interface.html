<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ROS Control: fennec_ns::FennecHWInterface Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ROS Control
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>fennec_ns</b></li><li class="navelem"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html">FennecHWInterface</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classfennec__ns_1_1_fennec_h_w_interface-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">fennec_ns::FennecHWInterface Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Hardware interface for a robot.  
 <a href="classfennec__ns_1_1_fennec_h_w_interface.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="fennec__hw__interface_8h_source.html">fennec_hw_interface.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for fennec_ns::FennecHWInterface:</div>
<div class="dyncontent">
<div class="center"><img src="classfennec__ns_1_1_fennec_h_w_interface__inherit__graph.png" border="0" usemap="#fennec__ns_1_1_fennec_h_w_interface_inherit__map" alt="Inheritance graph"/></div>
<map name="fennec__ns_1_1_fennec_h_w_interface_inherit__map" id="fennec__ns_1_1_fennec_h_w_interface_inherit__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for fennec_ns::FennecHWInterface:</div>
<div class="dyncontent">
<div class="center"><img src="classfennec__ns_1_1_fennec_h_w_interface__coll__graph.png" border="0" usemap="#fennec__ns_1_1_fennec_h_w_interface_coll__map" alt="Collaboration graph"/></div>
<map name="fennec__ns_1_1_fennec_h_w_interface_coll__map" id="fennec__ns_1_1_fennec_h_w_interface_coll__map">
<area shape="rect" id="node3" href="class_i2_c___driver.html" title="I2C_Driver" alt="" coords="181,13,267,39"/>
<area shape="rect" id="node4" href="class_p_c_a9685.html" title="PCA9685" alt="" coords="294,13,373,39"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2efa0dd31094aa112588ba5ca1ff6f69"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a2efa0dd31094aa112588ba5ca1ff6f69">FennecHWInterface</a> (ros::NodeHandle &amp;nh, urdf::Model *urdf_model=NULL)</td></tr>
<tr class="memdesc:a2efa0dd31094aa112588ba5ca1ff6f69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a2efa0dd31094aa112588ba5ca1ff6f69">More...</a><br /></td></tr>
<tr class="separator:a2efa0dd31094aa112588ba5ca1ff6f69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26858f1a85875199f276e12d5fe30113"><td class="memItemLeft" align="right" valign="top"><a id="a26858f1a85875199f276e12d5fe30113"></a>
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a26858f1a85875199f276e12d5fe30113">~FennecHWInterface</a> ()</td></tr>
<tr class="memdesc:a26858f1a85875199f276e12d5fe30113"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy the Fennec HW Interface:: Fennec HW Interface object. <br /></td></tr>
<tr class="separator:a26858f1a85875199f276e12d5fe30113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5e55d24cc4471e666f2e5e17977ca13"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#ad5e55d24cc4471e666f2e5e17977ca13">init</a> ()</td></tr>
<tr class="memdesc:ad5e55d24cc4471e666f2e5e17977ca13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the robot hardware interface.  <a href="#ad5e55d24cc4471e666f2e5e17977ca13">More...</a><br /></td></tr>
<tr class="separator:ad5e55d24cc4471e666f2e5e17977ca13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb8bbfce4a97c7f0a007a6ddf933be7a"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#adb8bbfce4a97c7f0a007a6ddf933be7a">read</a> (ros::Duration &amp;elapsed_time)</td></tr>
<tr class="memdesc:adb8bbfce4a97c7f0a007a6ddf933be7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the state from the robot hardware.  <a href="#adb8bbfce4a97c7f0a007a6ddf933be7a">More...</a><br /></td></tr>
<tr class="separator:adb8bbfce4a97c7f0a007a6ddf933be7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b68acf47d161d3c7d30d21b35327923"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a0b68acf47d161d3c7d30d21b35327923">write</a> (ros::Duration &amp;elapsed_time)</td></tr>
<tr class="memdesc:a0b68acf47d161d3c7d30d21b35327923"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the command to the robot hardware.  <a href="#a0b68acf47d161d3c7d30d21b35327923">More...</a><br /></td></tr>
<tr class="separator:a0b68acf47d161d3c7d30d21b35327923"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30250e644ed2ef16ee724289c8193066"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a30250e644ed2ef16ee724289c8193066">enforceLimits</a> (ros::Duration &amp;period)</td></tr>
<tr class="separator:a30250e644ed2ef16ee724289c8193066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a918620ccc3c2bc7852b2f9e5fa90c54c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a918620ccc3c2bc7852b2f9e5fa90c54c">encoderCallback</a> (const std_msgs::Int16::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:a918620ccc3c2bc7852b2f9e5fa90c54c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Counts the pulses of the encoder. Gets called everytime the rosserial node publishes a new msg.  <a href="#a918620ccc3c2bc7852b2f9e5fa90c54c">More...</a><br /></td></tr>
<tr class="separator:a918620ccc3c2bc7852b2f9e5fa90c54c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3d579b889bed76ab21335d767ac4ed4"><td class="memItemLeft" align="right" valign="top"><a id="ae3d579b889bed76ab21335d767ac4ed4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#ae3d579b889bed76ab21335d767ac4ed4">printCommands</a> ()</td></tr>
<tr class="memdesc:ae3d579b889bed76ab21335d767ac4ed4"><td class="mdescLeft">&#160;</td><td class="mdescRight">A helper function to print the ROS Controller Commands for each control loop to the console. <br /></td></tr>
<tr class="separator:ae3d579b889bed76ab21335d767ac4ed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a9e450fc1f1b96701f89be637a58622a9"><td class="memItemLeft" align="right" valign="top"><a id="a9e450fc1f1b96701f89be637a58622a9"></a>
const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a9e450fc1f1b96701f89be637a58622a9">m_i2c_device_name</a> = &quot;/dev/i2c-1&quot;</td></tr>
<tr class="memdesc:a9e450fc1f1b96701f89be637a58622a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The I2C Bus 1 is used by the <a class="el" href="class_p_c_a9685.html">PCA9685</a> boards. <br /></td></tr>
<tr class="separator:a9e450fc1f1b96701f89be637a58622a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c8cef371f076986ead0942304d134c"><td class="memItemLeft" align="right" valign="top"><a id="a62c8cef371f076986ead0942304d134c"></a>
<a class="el" href="class_i2_c___driver.html">I2C_Driver</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>m_i2c_driver</b> = new <a class="el" href="class_i2_c___driver.html">I2C_Driver</a>(<a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a9e450fc1f1b96701f89be637a58622a9">m_i2c_device_name</a>)</td></tr>
<tr class="separator:a62c8cef371f076986ead0942304d134c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad562b8627b08e5dfdda168ade82530d"><td class="memItemLeft" align="right" valign="top"><a id="aad562b8627b08e5dfdda168ade82530d"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#aad562b8627b08e5dfdda168ade82530d">m_steering_pca9685_address</a> = 0x40</td></tr>
<tr class="memdesc:aad562b8627b08e5dfdda168ade82530d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The default adress for a <a class="el" href="class_p_c_a9685.html">PCA9685</a> board. <br /></td></tr>
<tr class="separator:aad562b8627b08e5dfdda168ade82530d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8ebee84c63d1be3c949d58ab6087dbc"><td class="memItemLeft" align="right" valign="top"><a id="af8ebee84c63d1be3c949d58ab6087dbc"></a>
<a class="el" href="class_p_c_a9685.html">PCA9685</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>m_pca9685_servo_driver</b> = new <a class="el" href="class_p_c_a9685.html">PCA9685</a>(m_i2c_driver, <a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#aad562b8627b08e5dfdda168ade82530d">m_steering_pca9685_address</a>)</td></tr>
<tr class="separator:af8ebee84c63d1be3c949d58ab6087dbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a515996ba43ee57670c6275b560997876"><td class="memItemLeft" align="right" valign="top"><a id="a515996ba43ee57670c6275b560997876"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a515996ba43ee57670c6275b560997876">m_throttle_pca9685_address</a> = 0x60</td></tr>
<tr class="memdesc:a515996ba43ee57670c6275b560997876"><td class="mdescLeft">&#160;</td><td class="mdescRight">The adress of the 2nd <a class="el" href="class_p_c_a9685.html">PCA9685</a> board. <br /></td></tr>
<tr class="separator:a515996ba43ee57670c6275b560997876"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a6def1f04ecb0ca88b659aca69cfa60"><td class="memItemLeft" align="right" valign="top"><a id="a6a6def1f04ecb0ca88b659aca69cfa60"></a>
<a class="el" href="class_p_c_a9685.html">PCA9685</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>m_pca9685_throttle_driver</b> = new <a class="el" href="class_p_c_a9685.html">PCA9685</a>(m_i2c_driver, <a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a515996ba43ee57670c6275b560997876">m_throttle_pca9685_address</a>)</td></tr>
<tr class="separator:a6a6def1f04ecb0ca88b659aca69cfa60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1ca5a0a877c3bd02fcc2c93c8b85e60"><td class="memItemLeft" align="right" valign="top"><a id="ab1ca5a0a877c3bd02fcc2c93c8b85e60"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#ab1ca5a0a877c3bd02fcc2c93c8b85e60">m_old_num_pulses</a></td></tr>
<tr class="memdesc:ab1ca5a0a877c3bd02fcc2c93c8b85e60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Needed for calculating the driven rear wheel distance. <br /></td></tr>
<tr class="separator:ab1ca5a0a877c3bd02fcc2c93c8b85e60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a117444fd6f01a83c603bc3ff6b7a3ffe"><td class="memItemLeft" align="right" valign="top"><a id="a117444fd6f01a83c603bc3ff6b7a3ffe"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a117444fd6f01a83c603bc3ff6b7a3ffe">m_difference_num_of_pulses</a></td></tr>
<tr class="memdesc:a117444fd6f01a83c603bc3ff6b7a3ffe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Needed for calculating the driven rear wheel distance. <br /></td></tr>
<tr class="separator:a117444fd6f01a83c603bc3ff6b7a3ffe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ff004471cd398edf8ab25e0e34d8f2e"><td class="memItemLeft" align="right" valign="top"><a id="a2ff004471cd398edf8ab25e0e34d8f2e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a2ff004471cd398edf8ab25e0e34d8f2e">m_difference_num_pulses_since_last_read</a></td></tr>
<tr class="memdesc:a2ff004471cd398edf8ab25e0e34d8f2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Needed for calculating the driven rear wheel distance. <br /></td></tr>
<tr class="separator:a2ff004471cd398edf8ab25e0e34d8f2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8946e6a059010374d152c428e75c252"><td class="memItemLeft" align="right" valign="top"><a id="af8946e6a059010374d152c428e75c252"></a>
const u_int8_t&#160;</td><td class="memItemRight" valign="bottom"><b>servo_channel</b> = 0</td></tr>
<tr class="separator:af8946e6a059010374d152c428e75c252"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57306686ca8d401e8ee6c71c77c2b47c"><td class="memItemLeft" align="right" valign="top"><a id="a57306686ca8d401e8ee6c71c77c2b47c"></a>
ros::Subscriber&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#a57306686ca8d401e8ee6c71c77c2b47c">rosserial_sub</a></td></tr>
<tr class="memdesc:a57306686ca8d401e8ee6c71c77c2b47c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscriber to the /encoder_pulses topic, which is published by the Arduino. <br /></td></tr>
<tr class="separator:a57306686ca8d401e8ee6c71c77c2b47c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdb8c91b694144d8f4cd05780e15b0c1"><td class="memItemLeft" align="right" valign="top"><a id="afdb8c91b694144d8f4cd05780e15b0c1"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfennec__ns_1_1_fennec_h_w_interface.html#afdb8c91b694144d8f4cd05780e15b0c1">logging</a></td></tr>
<tr class="memdesc:afdb8c91b694144d8f4cd05780e15b0c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Can be changed at runtime with a ROS Param. <br /></td></tr>
<tr class="separator:afdb8c91b694144d8f4cd05780e15b0c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hardware interface for a robot. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2efa0dd31094aa112588ba5ca1ff6f69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2efa0dd31094aa112588ba5ca1ff6f69">&#9670;&nbsp;</a></span>FennecHWInterface()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fennec_ns::FennecHWInterface::FennecHWInterface </td>
          <td>(</td>
          <td class="paramtype">ros::NodeHandle &amp;&#160;</td>
          <td class="paramname"><em>nh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">urdf::Model *&#160;</td>
          <td class="paramname"><em>urdf_model</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nh</td><td>- Node handle for topics. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a918620ccc3c2bc7852b2f9e5fa90c54c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a918620ccc3c2bc7852b2f9e5fa90c54c">&#9670;&nbsp;</a></span>encoderCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fennec_ns::FennecHWInterface::encoderCallback </td>
          <td>(</td>
          <td class="paramtype">const std_msgs::Int16::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Counts the pulses of the encoder. Gets called everytime the rosserial node publishes a new msg. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The current number of pulses, counted by the Arduino, range is from -32768 to 32767 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a30250e644ed2ef16ee724289c8193066"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30250e644ed2ef16ee724289c8193066">&#9670;&nbsp;</a></span>enforceLimits()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void fennec_ns::FennecHWInterface::enforceLimits </td>
          <td>(</td>
          <td class="paramtype">ros::Duration &amp;&#160;</td>
          <td class="paramname"><em>period</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Enforce limits for all values before writing </p>

</div>
</div>
<a id="ad5e55d24cc4471e666f2e5e17977ca13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5e55d24cc4471e666f2e5e17977ca13">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void fennec_ns::FennecHWInterface::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize the robot hardware interface. </p>
<p>Open up the I2C communication and try to connect to the two <a class="el" href="class_p_c_a9685.html">PCA9685</a> boards for the motors. </p>

</div>
</div>
<a id="adb8bbfce4a97c7f0a007a6ddf933be7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb8bbfce4a97c7f0a007a6ddf933be7a">&#9670;&nbsp;</a></span>read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void fennec_ns::FennecHWInterface::read </td>
          <td>(</td>
          <td class="paramtype">ros::Duration &amp;&#160;</td>
          <td class="paramname"><em>elapsed_time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read the state from the robot hardware. </p>
<p>Gets called in every update cycle of the controller manager Updating the joint positions and velocities for the robot Counting the steps from the encoder motors and reading the current pwm from the servo motor to get the current values We want to overwrite the states of the robot stored in these variables std::vector&lt;double&gt; joint_position_; std::vector&lt;double&gt; joint_velocity_; std::vector&lt;double&gt; joint_effort_; Joint index 0: front_steer_joint, 1: rear_wheel_joint.</p>
<p>Steer Joint Readings Read the on and off bytes of the Servo PCA9865 Frequency of the servo is 50 Hz (common Hz for Servos) Pulse Length is 20ms This pulse is divided into 4096 ticks Servos expect a pulse length of 1 milliseconds to 2 milliseconds 1 ms = 0 degree, 2ms = 180 degree this result in the length of the on bytes to be between 204 bytes(4096 ticks/20ms * 1ms) and 409 bytes (4096 ticks/20ms * 2ms) respectively with this information we can determine the position of the servo motor and write that in the joint_position_[1] The maximum steering angle of the front wheels is around 24 degrees in either direction this equals around 0,4189 radians ROS Control expects the unit to be rad/s which is the angular velocity</p>
<p>Some important formulas for the calculation of the steering angle based on the read information from the PWM Signal: Steering angle (in degree) = atan(wheelbase / turning_radius) turning_radius = wheelbase / tan(steering_angle) Angular Velocity = speed (m/s) * tan(steering_angle) (rad) / wheelbase (m)</p>
<p>We have the problem that when the robot is driving backwards the odometry only cares for the rad/s (the change of rad/s to be specific) for that when we update the joint position and velocity we have to take into account in which direction we are driving If we are driving backwards we want to reverse the rad/s For forward driving we dont have to change anything</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">elapsed_time</td><td>Time since the last update cycle </td></tr>
  </table>
  </dd>
</dl>
<p>Determining the steering angle</p>
<p>Mapping to Value Ranges to one another</p>

</div>
</div>
<a id="a0b68acf47d161d3c7d30d21b35327923"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b68acf47d161d3c7d30d21b35327923">&#9670;&nbsp;</a></span>write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void fennec_ns::FennecHWInterface::write </td>
          <td>(</td>
          <td class="paramtype">ros::Duration &amp;&#160;</td>
          <td class="paramname"><em>elapsed_time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Write the command to the robot hardware. </p>
<p>Write the commands by ROS Control to the PCA 9685 motor drivers Controlling the servo (PositionJointInterface) The joint_position_command_ gives us a radian to work with from 0 to 3.141 we then translate that to the need pwm for the servo.</p>
<p>DC Motors std::vector&lt;double&gt; joint_velocity_command_[0] unit is rad/s e.g. 6.28/sec = 1 rev/sec 1 revolution equal 700 pulses by the encoder at 1600hz for the motors the maximum pwm in 0,000625s = 0,625ms = 625 microseconds</p>
<p>According to the speed test the motor at maximum pwm_pulse_width (tested with jetracer python library by nvidia/waveshare) turns 3,9 times/sec which equal 24,5 rad/s (2pi*3,9) or 84 cm/s = 0,84 m/s (with wheel circumference = 21,5 cm)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">elapsed_time</td><td>The time since the last update loop </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>fennec_control/include/fennec_control/<a class="el" href="fennec__hw__interface_8h_source.html">fennec_hw_interface.h</a></li>
<li>fennec_control/src/fennec_hw_interface.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
